<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Property Management System</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>


    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            padding-bottom: 70px;
            overflow-x: hidden;
            max-width: 100vw;
        }

        .container {
            width: 100%;
            max-width: 430px;
            margin: 0 auto;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 0;
            overflow: hidden;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.15);
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 430px;
            background: white;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.15);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 8px 0 calc(8px + env(safe-area-inset-bottom));
            height: 70px;
            border-top: 1px solid #eee;
            z-index: 1000;
            border-radius: 0 0 20px 20px;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #888;
            padding: 8px 4px;
            border: none;
            background: none;
            position: relative;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .nav-item:active {
            transform: scale(0.9);
            background: #f5f5f5;
            border-radius: 8px;
        }

        .nav-item.active {
            color: #667eea;
        }

        .nav-item.active::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 3px;
            background: #667eea;
            border-radius: 0 0 3px 3px;
        }

        .nav-item i {
            font-size: 20px;
        }

        .nav-item span {
            font-size: 10px;
            font-weight: 500;
        }

        .main-content {
            padding: 12px;
            max-width: 100vw;
            overflow-x: hidden;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page-header {
            background: white;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .page-header h1 {
            color: #333;
            font-size: 22px;
            margin-bottom: 4px;
        }

        .page-header h3 {
            font-size: 15px;
            color: #333;
            margin-bottom: 12px;
        }

        .page-header p {
            color: #777;
            font-size: 13px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 12px;
        }

        .stat-card {
            background: white;
            padding: 14px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .add-property-container {
            background: #fff;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .title {
            text-align: center;
            color: #667eea;
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 4px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            font-size: 12px;
            margin-bottom: 16px;
        }

        .step-tabs {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .step-btn {
            background: #eee;
            border: none;
            padding: 8px 14px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 12px;
            touch-action: manipulation;
        }

        .step-btn:active {
            transform: scale(0.95);
        }

        .step-btn.active {
            background: #667eea;
            color: white;
        }

        .step-content {
            display: none;
        }

        .step-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            font-size: 13px;
            font-weight: 600;
            display: block;
            margin-bottom: 5px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #ccc;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 16px;
            gap: 10px;
        }

        .next-btn, .back-btn {
            background: #667eea;
            color: #fff;
            border: none;
            padding: 14px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            flex: 1;
            touch-action: manipulation;
        }

        .back-btn {
            background: #999;
        }

        .next-btn:active, .back-btn:active {
            transform: scale(0.97);
        }

        .sub-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .sub-btn {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            background: #f8f8ff;
            border-radius: 6px;
            cursor: pointer;
        }

        .sub-btn.active {
            background: #667eea;
            color: white;
        }

        .sub-tab {
            display: none;
        }

        .sub-tab.active {
            display: block;
        }

        .card {
            background: #fff;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }

        .card.yellow { background: #fffbea; }
        .card.green { background: #e9fff0; }

        .form-row {
            margin-bottom: 10px;
        }

        .form-row label {
            display: block;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .expense-item, .add-row {
            display: flex;
            gap: 6px;
            margin-bottom: 8px;
        }

        .expense-item input, .add-row input {
            flex: 1;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        .expense-item button {
            background: #ff4d4f;
            color: #fff;
            border: none;
            border-radius: 6px;
            padding: 4px 10px;
            cursor: pointer;
        }

        .add-row button, .add-btn {
            background: #4a2fd4;
            color: #fff;
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            cursor: pointer;
        }

        .summary-box {
            background: #f5f4ff;
            border-radius: 8px;
            padding: 12px;
            margin-top: 10px;
        }

        .dynamic-summary {
            background: #edfaff;
            border-radius: 8px;
            padding: 12px;
            margin-top: 15px;
        }

        .upload-box {
            border: 2px dashed #a88df0;
            border-radius: 10px;
            background: #f5f3ff;
            padding: 24px 16px;
            text-align: center;
            cursor: pointer;
            margin-bottom: 14px;
            touch-action: manipulation;
        }

        .upload-box input {
            display: none;
        }

        .cloud-icon {
            font-size: 32px;
            color: #667eea;
        }

        .upload-box p {
            margin-top: 8px;
            font-size: 13px;
            color: #333;
        }

        .upload-box span {
            font-size: 11px;
            color: #777;
        }

        .preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }

        .preview-container img {
            width: 70px;
            height: 70px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #ddd;
        }

        .slider-group {
            margin: 16px 0;
        }

        .slider-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 13px;
            font-weight: 600;
            color: #555;
        }

        .slider-group input {
            width: 100%;
            height: 6px;
        }

        .property-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .property-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .property-image {
            height: 160px;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .property-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.95);
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
        }

        .property-badge.rented {
            color: #10b981;
        }

        .property-badge.available {
            color: #667eea;
        }

        .property-content {
            padding: 12px;
        }

        .property-title {
            font-size: 16px;
            font-weight: 700;
            color: #333;
            margin-bottom: 6px;
        }

        .property-location {
            color: #777;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
            margin-bottom: 10px;
        }

        .property-details {
            display: flex;
            gap: 12px;
            margin-bottom: 10px;
            padding-top: 10px;
            border-top: 1px solid #f0f0f0;
        }

        .property-detail {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 11px;
            color: #555;
        }

        .property-detail i {
            color: #667eea;
        }

        .property-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .property-price {
            font-size: 18px;
            font-weight: 700;
            color: #667eea;
        }

        .property-actions {
            display: flex;
            gap: 6px;
        }

        .btn-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            touch-action: manipulation;
        }

        .btn-view {
            background: #e0f2fe;
            color: #0284c7;
        }

        .btn-clone {
            background: #fef3c7;
            color: #d97706;
        }

        .btn-edit {
            background: #f0f0f0;
            color: #667eea;
        }

        .btn-delete {
            background: #fee;
            color: #ef4444;
        }

        .btn-icon:active {
            transform: scale(0.9);
        }

        .cash-flow-cards {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }

        .flow-card {
            background: white;
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .flow-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .flow-title {
            font-size: 13px;
            color: #777;
            font-weight: 600;
        }

        .flow-amount {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .flow-amount.income {
            color: #10b981;
        }

        .flow-amount.expense {
            color: #ef4444;
        }

        .flow-amount.profit {
            color: #667eea;
        }

        .transaction-list {
            background: white;
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .transaction-info h4 {
            font-size: 13px;
            color: #333;
            margin-bottom: 4px;
        }

        .transaction-info p {
            font-size: 11px;
            color: #777;
        }

        .transaction-amount {
            font-size: 15px;
            font-weight: 700;
        }

        .transaction-amount.income {
            color: #10b981;
        }

        .settings-container {
            max-width: 420px;
            margin: 0 auto;
            background: #fff;
            padding: 24px;
            border-radius: 18px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            margin-top: 25px;
        }

        .settings-container h2 {
            text-align: center;
            color: #333;
            font-size: 20px;
            margin-bottom: 25px;
        }

        .profile-image-section {
            display: flex;
            justify-content: center;
            margin-bottom: 25px;
            position: relative;
        }

        .image-wrapper {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid #6f5de7;
            cursor: pointer;
        }

        .image-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .image-wrapper .overlay {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 30%;
            background: rgba(0, 0, 0, 0.4);
            color: #fff;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s ease;
            border-bottom-left-radius: 50%;
            border-bottom-right-radius: 50%;
        }

        .image-wrapper:hover .overlay {
            opacity: 1;
        }

        #profilePicInput {
            display: none;
        }

        .section {
            margin-bottom: 25px;
        }

        .section h3 {
            font-size: 15px;
            font-weight: 600;
            color: #444;
            margin-bottom: 12px;
            border-bottom: 1px solid #eee;
            padding-bottom: 6px;
        }

        .section label {
            display: block;
            font-size: 13px;
            color: #555;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .section input,
        .section select {
            width: 100%;
            padding: 10px 12px;
            font-size: 13px;
            border-radius: 8px;
            border: 1px solid #ccc;
            margin-bottom: 12px;
            transition: all 0.2s ease;
        }

        .section input:focus,
        .section select:focus {
            outline: none;
            border-color: #6f5de7;
            box-shadow: 0 0 0 2px rgba(111, 93, 231, 0.15);
        }

        .export-btns {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .export-btn {
            background: #6f5de7;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 10px 0;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .export-btn:hover {
            background: #5a4ac7;
            transform: translateY(-1px);
        }

        .save-btn {
            width: 100%;
            background: #12b886;
            color: #fff;
            font-weight: 600;
            border: none;
            padding: 12px 0;
            font-size: 15px;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 5px;
            box-shadow: 0 3px 10px rgba(18, 184, 134, 0.3);
            transition: all 0.2s ease;
        }

        .save-btn:hover {
            background: #0fa678;
            transform: translateY(-2px);
        }

        .search-filter {
            background: white;
            padding: 12px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 12px;
        }

        .search-box {
            position: relative;
            margin-bottom: 10px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 40px 12px 12px;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            font-size: 16px;
        }

        .search-box input:focus {
            outline: none;
            border-color: #667eea;
        }

        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #777;
        }

        .filter-select {
            padding: 12px;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            width: 100%;
            margin-bottom: 10px;
        }

        .filter-select:last-child {
            margin-bottom: 0;
        }

        .filter-select:focus {
            outline: none;
            border-color: #667eea;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #777;
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 12px;
            color: #ccc;
        }

        .empty-state h3 {
            font-size: 16px;
            margin-bottom: 6px;
            color: #555;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            max-width: 90%;
            width: 100%;
        }

        .modal-header {
            padding: 16px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 16px;
            color: #333;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: #777;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
        }

        .modal-body {
            padding: 16px;
        }

        .modal-footer {
            padding: 12px 16px;
            border-top: 2px solid #f0f0f0;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #555;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            touch-action: manipulation;
        }

        .btn-secondary:active {
            transform: scale(0.95);
        }

        .btn-danger {
            background: #ef4444;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            touch-action: manipulation;
        }

        .btn-danger:active {
            transform: scale(0.95);
        }

        canvas {
            max-width: 100%;
            height: auto !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <main class="main-content">
           
            <!-- Dashboard Page -->
<div id="dashboard" class="page active" style="background: linear-gradient(180deg, #6366f1 0%, #8b5cf6 100%); min-height: 100vh; padding-bottom: 100px;">
    <div class="page-header" style="background: transparent; box-shadow: none;">
        <h1 style="color: white;">Dashboard</h1>
       <p style="color: #e0e7ff;">Overview of your properties and financial performance</p>

    </div>

    <!-- Income / Expense / Profit -->
    <div class="page-header" style="background: white;">
        <h3>Total Income</h3>
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <span id="dashIncome" style="font-size: 24px; font-weight: 600; color: #10b981;">‚Çπ0</span>
            <i class="fas fa-arrow-up" style="color: #10b981;"></i>
        </div>
        <p style="color: #6b7280; margin-top: 4px;">This month</p>
    </div>

    <div class="page-header" style="background: white;">
        <h3>Total Expenses</h3>
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <span id="dashExpense" style="font-size: 24px; font-weight: 600; color: #ef4444;">‚Çπ0</span>
            <i class="fas fa-arrow-down" style="color: #ef4444;"></i>
        </div>
        <p style="color: #6b7280; margin-top: 4px;">This month</p>
    </div>

    <div class="page-header" style="background: white;">
        <h3>Net Profit</h3>
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <span id="dashProfit" style="font-size: 24px; font-weight: 600; color: #3b82f6;">‚Çπ0</span>
            <i class="fas fa-chart-line" style="color: #3b82f6;"></i>
        </div>
        <p style="color: #6b7280; margin-top: 4px;">This month</p>
    </div>

    <!-- üîπ Portfolio Overview Section -->
    <div class="page-header" style="background: white;">
        <h3>Portfolio Overview</h3>
        <div style="display: flex; flex-wrap: wrap; justify-content: space-between; gap: 10px; margin-top: 10px;">
            <div style="flex:1; min-width:45%;">
                <p style="font-size:13px; color:#6b7280;">Total Properties</p>
                <h2 id="totalProperties" style="color:#4f46e5;">0</h2>
            </div>
            <div style="flex:1; min-width:45%;">
                <p style="font-size:13px; color:#6b7280;">Rented Properties</p>
                <h2 id="rentedProperties" style="color:#10b981;">0</h2>
            </div>
            <div style="flex:1; min-width:45%;">
                <p style="font-size:13px; color:#6b7280;">Available Units</p>
                <h2 id="availableProperties" style="color:#f59e0b;">0</h2>
            </div>
            <div style="flex:1; min-width:45%;">
                <p style="font-size:13px; color:#6b7280;">Average Rent</p>
                <h2 id="averageRent" style="color:#3b82f6;">‚Çπ0</h2>
            </div>
        </div>
    </div>

    <!-- üîπ Income vs Expense Chart -->
    <div class="page-header" style="background: white;">
        <h3>Income vs Expense Overview</h3>
        <canvas id="incomeExpenseChart" height="160"></canvas>
    </div>

    <!-- üîπ Valuation Growth -->
    <div class="page-header" style="background: white;">
        <h3>Valuation Growth (3 / 5 / 10 Years)</h3>
        <canvas id="valuationGrowthChart" height="160"></canvas>
    </div>

    <!-- üîπ Recent Transactions -->
    <div class="page-header" style="background: white;">
        <h3>Recent Transactions</h3>
        <div id="recent-transactions" style="margin-top: 10px;"></div>
    </div>
</div>


            <!-- Properties Page -->
            <div id="properties" class="page">
                <div class="page-header">
                    <h1>Properties</h1>
                    <p>Manage your property portfolio</p>
                </div>

                <div class="search-filter">
                    <div class="search-box">
                        <input type="text" id="search-input" placeholder="Search properties...">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                    <select class="filter-select" id="status-filter">
                        <option value="">All Status</option>
                        <option value="rented">Rented</option>
                        <option value="available">Available</option>
                        <option value="maintenance">Maintenance</option>
                    </select>
                    <select class="filter-select" id="type-filter">
                        <option value="">All Types</option>
                        <option value="apartment">Apartment</option>
                        <option value="house">House</option>
                        <option value="villa">Villa</option>
                    </select>
                </div>

                <div class="property-grid" id="properties-grid"></div>
                
                <div id="empty-state" class="empty-state" style="display: none;">
                    <i class="fas fa-building"></i>
                    <h3>No Properties Found</h3>
                    <p>Add your first property to get started</p>
                </div>
            </div>

            <!-- Add Property Page -->
            <div id="add-property" class="page">
                <div class="add-property-container">
                    <h2 class="title">Property Manager</h2>
                    <p class="subtitle">Add New Commercial Property</p>

                    <div class="step-tabs">
                        <button class="step-btn active" onclick="showStep(1)">Details</button>
                        <button class="step-btn" onclick="showStep(2)">Financials</button>
                        <button class="step-btn" onclick="showStep(3)">Projections</button>
                    </div>

                    <!-- Step 1 -->
                    <div id="step1" class="step-content active">
                        <h3 style="font-size: 15px; margin-bottom: 12px;">Property Details</h3>

                        <div class="upload-section">
                            <label style="display: block; margin-bottom: 8px; font-size: 13px; font-weight: 600;">Property Images</label>
                            <div id="uploadBox" class="upload-box" onclick="document.getElementById('fileInput').click()">
                                <i class="cloud-icon">‚òÅÔ∏è</i>
                                <p>Tap to upload images</p>
                                <span>PNG, JPG up to 5MB</span>
                                <input id="fileInput" type="file" accept="image/*" multiple onchange="handleFiles(this.files)">
                            </div>
                            <div id="previewContainer" class="preview-container"></div>
                        </div>

                        <div class="form-group">
                            <label>Property Name *</label>
                            <input type="text" id="propertyName" placeholder="e.g., Sunset Apartments">
                        </div>
                        
                        <div class="form-group">
                            <label>Property Type *</label>
                            <select id="propertyType" onchange="updateDynamicField()">
                                <option value="">Select type</option>
                                <option value="villa">Luxury Villa</option>
                                <option value="hotel">Hotel</option>
                                <option value="restaurant">Restaurant</option>
                                <option value="office">Office</option>
                                <option value="industrial">Industrial</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Property Value (‚Çπ) *</label>
                            <input type="number" id="purchasePrice" placeholder="Enter value">
                        </div>
                        
                        <div id="dynamicFieldContainer"></div>
                        
                        <div class="form-group">
                            <label>City *</label>
                            <input type="text" id="city" placeholder="Enter city">
                        </div>

                        <div class="buttons">
                            <button class="next-btn" onclick="showStep(2)">Next ‚Üí</button>
                        </div>
                    </div>

                    <!-- Step 2 -->
                    <div id="step2" class="step-content">
                        <h3 class="section-title">Step 2 ¬∑ Detailed Annual Operations</h3>
                        <p class="subtitle">Calculate baseline Net Operating Income (NOI) using current metrics.</p>

                        <div class="sub-tabs">
                            <button class="sub-btn active" onclick="showSubTab('revenue')">Revenue Drivers</button>
                            <button class="sub-btn" onclick="showSubTab('expenses')">Operating Expenses</button>
                            <button class="sub-btn" onclick="showSubTab('finance')">Financing & Investment</button>
                        </div>

                        <!-- REVENUE -->
                        <div id="sub-revenue" class="sub-tab active">
                            <div class="card">
                                <h4>Core Revenue Drivers</h4>
                                <div class="form-row">
                                    <label>Avg Margin per Gallon (‚Çπ)</label>
                                    <input type="number" id="avgMargin" value="176" oninput="updateTotals()">
                                </div>
                                <div class="form-row">
                                    <label>Avg Daily Gallons Sold (%)</label>
                                    <input type="number" id="dailyGallons" value="70" oninput="updateTotals()">
                                </div>
                            </div>

                            <div class="card">
                                <h4>Ancillary Revenue Streams</h4>
                                <div id="extraRevenue"></div>
                                <div class="add-row">
                                    <input type="text" id="newRevName" placeholder="Name">
                                    <input type="number" id="newRevValue" placeholder="Amount">
                                    <button onclick="addRevenue()">Add</button>
                                </div>
                            </div>

                            <div class="summary-box">
                                <p><b>Total Calculated Revenue:</b> ‚Çπ<span id="totalRevenue">0</span></p>
                            </div>
                        </div>

                        <!-- EXPENSES -->
                        <div id="sub-expenses" class="sub-tab">
                            <div class="card">
                                <h4>Structural & CapEx Maintenance</h4>
                                <div id="maintenanceList">
                                    <div class="expense-item"><input type="text" value="Roof/Foundation"><input type="number" value="50000" oninput="updateTotals()"><button onclick="removeItem(this)">‚úñ</button></div>
                                    <div class="expense-item"><input type="text" value="HVAC/Plumbing"><input type="number" value="150000" oninput="updateTotals()"><button onclick="removeItem(this)">‚úñ</button></div>
                                </div>
                            </div>

                            <div class="card">
                                <h4>Operational Expenses</h4>
                                <div id="operatingList">
                                    <div class="expense-item"><input type="text" value="Staffing & Payroll"><input type="number" value="1550000" oninput="updateTotals()"><button onclick="removeItem(this)">‚úñ</button></div>
                                    <div class="expense-item"><input type="text" value="Utilities & Services"><input type="number" value="300000" oninput="updateTotals()"><button onclick="removeItem(this)">‚úñ</button></div>
                                </div>
                            </div>

                            <div class="card">
                                <h4>Custom Expenses (‚Çπ)</h4>
                                <div id="customExpenses"></div>
                                <div class="add-row">
                                    <input type="text" id="customName" placeholder="Name">
                                    <input type="number" id="customAmount" placeholder="Amount">
                                    <button onclick="addCustomExpense()">Add</button>
                                </div>
                            </div>

                            <div class="summary-box">
                                <p><b>Total Calculated Expenses:</b> ‚Çπ<span id="totalExpenses">0</span></p>
                            </div>
                        </div>

                        <!-- FINANCE -->
                        <div id="sub-finance" class="sub-tab">
                            <div class="card yellow">
                                <h4>Loan Components (P&I)</h4>
                                <div id="loanList"></div>
                                <button class="add-btn" onclick="addLoan()">+ Add New Loan</button>
                            </div>

                            <div class="card green">
                                <h4>Investment Inputs (Equity & Costs)</h4>
                                <div class="form-row">
                                    <label>Cash Investment (Equity)</label>
                                    <input type="number" id="cashInvestment" value="5000000" oninput="updateTotals()">
                                </div>
                                <div class="form-row">
                                    <label>Closing Costs (% of Purchase Price)</label>
                                    <input type="number" id="closingCost" value="3" oninput="updateTotals()">
                                </div>
                            </div>

                            <div class="summary-box">
                                <p><b>Total Equity Invested:</b> ‚Çπ<span id="totalEquity">0</span></p>
                                <p><b>Annual Debt Service (P&I):</b> ‚Çπ<span id="totalLoan">0</span></p>
                            </div>
                        </div>

                        <div class="dynamic-summary">
                            <h4>Dynamic Readout</h4>
                            <p><b>Total Revenue:</b> ‚Çπ<span id="dynRevenue">0</span></p>
                            <p><b>Total Expenses:</b> ‚Çπ<span id="dynExpenses">0</span></p>
                            <p><b>Current NOI:</b> ‚Çπ<span id="dynNOI">0</span></p>
                        </div>

                        <div class="buttons">
                            <button class="back-btn" onclick="showStep(1)">‚Üê Back</button>
                            <button class="next-btn" onclick="showStep(3)">Next ¬∑ Projections ‚Üí</button>
                        </div>
                    </div>

                    <!-- Step 3 -->
                    <div id="step3" class="step-content">
                        <h3 style="font-size: 15px; margin-bottom: 12px;">Growth Assumptions</h3>

                        <div class="slider-group">
                            <label>Revenue Growth: <span id="revVal">3%</span></label>
                            <input type="range" min="0" max="10" value="3" step="0.1" oninput="updateSlider('revVal', this.value)">
                        </div>

                        <div class="slider-group">
                            <label>Expense Growth: <span id="expVal">2.5%</span></label>
                            <input type="range" min="0" max="10" value="2.5" step="0.1" oninput="updateSlider('expVal', this.value)">
                        </div>

                        <div class="slider-group">
                            <label>Exit Cap Rate: <span id="capVal">7.5%</span></label>
                            <input type="range" min="5" max="15" value="7.5" step="0.1" oninput="updateSlider('capVal', this.value)">
                        </div>

                        <div class="buttons">
                            <button class="back-btn" onclick="showStep(2)">‚Üê Back</button>
                            <button class="next-btn" onclick="saveProperty()">üíæ Save Property</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cash Flow Page -->
            <div id="cash-flow" class="page">
                <div class="page-header">
                    <h1>Cash Flow</h1>
                    <p>Track income and expenses</p>
                </div>

                <div class="cash-flow-cards">
                    <div class="flow-card">
                        <div class="flow-header">
                            <span class="flow-title">Total Income</span>
                            <i class="fas fa-arrow-up" style="color: #10b981; font-size: 18px;"></i>
                        </div>
                        <div class="flow-amount income" id="totalIncome">‚Çπ0</div>
                        <p style="color: #777; font-size: 12px;">This month</p>
                    </div>

                    <div class="flow-card">
                        <div class="flow-header">
                            <span class="flow-title">Total Expenses</span>
                            <i class="fas fa-arrow-down" style="color: #ef4444; font-size: 18px;"></i>
                        </div>
                        <div class="flow-amount expense" id="totalExpenses">‚Çπ0</div>
                        <p style="color: #777; font-size: 12px;">This month</p>
                    </div>

                    <div class="flow-card">
                        <div class="flow-header">
                            <span class="flow-title">Net Profit</span>
                            <i class="fas fa-chart-line" style="color: #667eea; font-size: 18px;"></i>
                        </div>
                        <div class="flow-amount profit" id="netProfit">‚Çπ0</div>
                        <p style="color: #777; font-size: 12px;">This month</p>
                    </div>
                </div>

                <div class="transaction-list">
                    <h3 style="margin-bottom: 12px; color: #333; font-size: 15px;">Recent Transactions</h3>
                    <div id="transactions-list"></div>
                </div>

                <div class="page-header" style="margin-top: 20px;">
                    <h3 style="font-size: 15px; color: #333;">3-Year Cash Flow</h3>
                    <canvas id="flow3yr"></canvas>
                </div>

                <div class="page-header">
                    <h3 style="font-size: 15px; color: #333;">5-Year Cash Flow</h3>
                    <canvas id="flow5yr"></canvas>
                </div>

                <div class="page-header">
                    <h3 style="font-size: 15px; color: #333;">10-Year Cash Flow</h3>
                    <canvas id="flow10yr"></canvas>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settings" class="page">
                <div class="settings-container">
                    <h2>Settings</h2>

                    <div class="profile-image-section">
                        <div class="image-wrapper" onclick="document.getElementById('profilePicInput').click()">
                            <img id="profilePicPreview" src="https://via.placeholder.com/100" alt="Profile" />
                            <div class="overlay">üì∑</div>
                        </div>
                        <input type="file" id="profilePicInput" accept="image/*" onchange="loadProfileImage(event)" />
                    </div>

                    <div class="section">
                        <h3>Profile</h3>
                        <label>Full Name</label>
                        <input type="text" id="fullName" placeholder="Enter full name" />

                        <label>Email</label>
                        <input type="email" id="email" placeholder="Enter email address" />

                        <label>Phone</label>
                        <input type="text" id="phone" placeholder="+91 98765 43210" />
                    </div>

                    <div class="section">
                        <h3>Preferences</h3>
                        <label>Theme</label>
                        <select id="theme">
                            <option>Light</option>
                            <option>Dark</option>
                        </select>

                        <label>Currency</label>
                        <select id="currency">
                            <option>INR (‚Çπ)</option>
                            <option>USD ($)</option>
                            <option>EUR (‚Ç¨)</option>
                        </select>
                    </div>

                    <div class="section">
                        <h3>Data Export</h3>
                        <div class="export-btns">
                            <button class="export-btn" onclick="exportData('pdf')">Export as PDF</button>
                            <button class="export-btn" onclick="exportData('excel')">Export as Excel</button>
                            <button class="export-btn" onclick="exportData('csv')">Export as CSV</button>
                        </div>
                    </div>

                    <div class="section">
                        <h3>Security</h3>
                        <label>Current Password</label>
                        <input type="password" id="currentPass" placeholder="Enter current password" />

                        <label>New Password</label>
                        <input type="password" id="newPass" placeholder="Enter new password" />
                    </div>

                    <button class="save-btn" onclick="saveSettings()">üíæ Save Changes</button>
                </div>
            </div>

        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" onclick="showPage('dashboard')">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </button>
            <button class="nav-item" onclick="showPage('properties')">
                <i class="fas fa-building"></i>
                <span>Properties</span>
            </button>
            <button class="nav-item" onclick="showPage('add-property')">
                <i class="fas fa-plus-circle"></i>
                <span>Add</span>
            </button>
            <button class="nav-item" onclick="showPage('cash-flow')">
                <i class="fas fa-chart-line"></i>
                <span>Cash Flow</span>
            </button>
            <button class="nav-item" onclick="showPage('settings')">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </button>
        </nav>
    </div>

    <!-- Delete Modal -->
    <div id="delete-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Confirm Delete</h3>
                <button class="modal-close" onclick="closeModal('delete-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this property? This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('delete-modal')">Cancel</button>
                <button class="btn-danger" id="confirm-delete">Delete</button>
            </div>
        </div>
    </div>

    <script>
        let properties = {
            1: {
                id: 1,
                propertyName: "Sunset Apartments",
                propertyType: "apartment",
                streetAddress: "123 Main St",
                city: "New York",
                state: "NY",
                zipCode: "10001",
                bedrooms: "3",
                bathrooms: "2",
                sqft: "1200",
                monthlyRent: "2500",
                propertyStatus: "rented",
                image: "https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?w=400"
            },
            2: {
                id: 2,
                propertyName: "Ocean View Villa",
                propertyType: "villa",
                streetAddress: "456 Beach Rd",
                city: "Miami",
                state: "FL",
                zipCode: "33101",
                bedrooms: "4",
                bathrooms: "3",
                sqft: "2500",
                monthlyRent: "4200",
                propertyStatus: "available",
                image: "https://images.unsplash.com/photo-1516455590571-18256e5bb9ff?w=400"
            },
            3: {
                id: 3,
                propertyName: "Downtown Loft",
                propertyType: "apartment",
                streetAddress: "789 City Ave",
                city: "Chicago",
                state: "IL",
                zipCode: "60601",
                bedrooms: "2",
                bathrooms: "2",
                sqft: "1800",
                monthlyRent: "3100",
                propertyStatus: "rented",
                image: "https://images.unsplash.com/photo-1512917774080-9991f1c4c750?w=400"
            }
        };

        let nextPropertyId = 4;
        let currentDeleteId = null;
        let chartInstances = {};

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            
            document.getElementById(pageId).classList.add('active');
            
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                if (item.getAttribute('onclick')?.includes(pageId)) {
                    item.classList.add('active');
                }
            });
            
            if (pageId === 'properties') renderProperties();
            if (pageId === 'dashboard') updateDashboard();
            if (pageId === 'cash-flow') {
                updateCashFlow();
                renderCashFlowCharts();
            }
            if (pageId === 'settings') loadSettings();
        }

        function renderProperties() {
            const propertyGrid = document.getElementById('properties-grid');
            
            if (Object.keys(properties).length === 0) {
                document.getElementById('empty-state').style.display = 'block';
                propertyGrid.innerHTML = '';
                return;
            }
            
            document.getElementById('empty-state').style.display = 'none';
            const sortedProperties = Object.values(properties).sort((a, b) => b.id - a.id);
            
            propertyGrid.innerHTML = sortedProperties.map(property => createPropertyCard(property)).join('');
            filterProperties();
        }

        function createPropertyCard(property) {
            const statusClass = property.propertyStatus === 'rented' ? 'rented' : 
                               property.propertyStatus === 'available' ? 'available' : 'maintenance';
            
            const statusText = property.propertyStatus === 'rented' ? 'Rented' : 
                              property.propertyStatus === 'available' ? 'Available' : 'Maintenance';
            
            return `
                <div class="property-card" data-property-id="${property.id}">
                    <div class="property-image" style="background-image: url('${property.image || 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=400'}');">
                        <div class="property-badge ${statusClass}">${statusText}</div>
                    </div>
                    <div class="property-content">
                        <h3 class="property-title">${property.propertyName}</h3>
                        <p class="property-location">
                            <i class="fas fa-map-marker-alt"></i> ${property.streetAddress}, ${property.city}
                        </p>
                        <div class="property-details">
                            <div class="property-detail">
                                <i class="fas fa-bed"></i> ${property.bedrooms} Beds
                            </div>
                            <div class="property-detail">
                                <i class="fas fa-bath"></i> ${property.bathrooms} Bath
                            </div>
                            <div class="property-detail">
                                <i class="fas fa-ruler-combined"></i> ${property.sqft} sqft
                            </div>
                        </div>
                        <div class="property-footer">
                            <div class="property-price">‚Çπ${parseFloat(property.monthlyRent).toLocaleString()}/mo</div>
                            <div class="property-actions">
                                <button class="btn-icon btn-view" onclick="viewProperty(${property.id})" title="View">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn-icon btn-clone" onclick="cloneProperty(${property.id})" title="Clone">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <button class="btn-icon btn-edit" onclick="editProperty(${property.id})" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-icon btn-delete" onclick="deleteProperty(${property.id})" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function viewProperty(id) {
            const property = properties[id];
            if (!property) return;
            
            alert(`Property: ${property.propertyName}\nType: ${property.propertyType}\nAddress: ${property.streetAddress}, ${property.city}\nBedrooms: ${property.bedrooms}\nBathrooms: ${property.bathrooms}\nRent: ‚Çπ${property.monthlyRent}/mo\nStatus: ${property.propertyStatus}`);
        }

        function cloneProperty(id) {
            const property = properties[id];
            if (!property) return;
            
            if (confirm(`Clone "${property.propertyName}"?`)) {
                const newProperty = { ...property };
                newProperty.id = nextPropertyId++;
                newProperty.propertyName = property.propertyName + " (Copy)";
                
                properties[newProperty.id] = newProperty;
                renderProperties();
                updateDashboard();
                alert('Property cloned successfully!');
            }
        }

        function editProperty(id) {
            alert('Edit functionality - Coming soon!');
        }

        function deleteProperty(id) {
            currentDeleteId = id;
            document.getElementById('delete-modal').classList.add('active');
        }

        document.getElementById('confirm-delete').addEventListener('click', function() {
            if (!currentDeleteId) return;
            
            delete properties[currentDeleteId];
            renderProperties();
            updateDashboard();
            updateCashFlow();
            
            closeModal('delete-modal');
            alert('Property deleted successfully.');
        });

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            currentDeleteId = null;
        }

        function filterProperties() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const statusFilter = document.getElementById('status-filter').value;
            const typeFilter = document.getElementById('type-filter').value;
            
            const propertyCards = document.querySelectorAll('.property-card');
            let visibleCount = 0;
            
            propertyCards.forEach(card => {
                const id = card.getAttribute('data-property-id');
                const property = properties[id];
                
                if (!property) return;
                
                const matchesSearch = property.propertyName.toLowerCase().includes(searchTerm) || 
                                    property.streetAddress.toLowerCase().includes(searchTerm) ||
                                    property.city.toLowerCase().includes(searchTerm);
                
                const matchesStatus = !statusFilter || property.propertyStatus === statusFilter;
                const matchesType = !typeFilter || property.propertyType === typeFilter;
                
                if (matchesSearch && matchesStatus && matchesType) {
                    card.style.display = 'block';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });
            
            document.getElementById('empty-state').style.display = visibleCount === 0 ? 'block' : 'none';
        }

       function updateDashboard() {
  const totalIncome = Object.values(properties).reduce((t, p) => t + (p.propertyStatus === 'rented' ? parseFloat(p.monthlyRent) : 0), 0);
  const totalExpenses = Math.round(totalIncome * 0.25);
  const netProfit = totalIncome - totalExpenses;
  const rented = Object.values(properties).filter(p => p.propertyStatus === 'rented').length;
  const available = Object.values(properties).filter(p => p.propertyStatus === 'available').length;
  const avgRent = totalIncome / (rented || 1);

  document.getElementById('dashIncome').textContent = '‚Çπ' + totalIncome.toLocaleString();
  document.getElementById('dashExpense').textContent = '‚Çπ' + totalExpenses.toLocaleString();
  document.getElementById('dashProfit').textContent = '‚Çπ' + netProfit.toLocaleString();
  document.getElementById('totalProperties').textContent = Object.keys(properties).length;
  document.getElementById('rentedProperties').textContent = rented;
  document.getElementById('availableProperties').textContent = available;
  document.getElementById('averageRent').textContent = '‚Çπ' + Math.round(avgRent).toLocaleString();

  updateTransactions();
  renderHomeCharts(totalIncome, totalExpenses);
}
      
function renderHomeCharts(income, expenses) {
  // Destroy if exists
  if (window.homeCharts) {
    window.homeCharts.forEach(c => c.destroy());
  }
  window.homeCharts = [];

  const incomeExpenseCtx = document.getElementById('incomeExpenseChart');
  const valuationCtx = document.getElementById('valuationGrowthChart');
  if (!incomeExpenseCtx || !valuationCtx) return;

  const incomeExpenseChart = new Chart(incomeExpenseCtx, {
    type: 'bar',
    data: {
      labels: ['Income', 'Expenses', 'Profit'],
      datasets: [{
        data: [income, expenses, income - expenses],
        backgroundColor: ['#10b981', '#ef4444', '#3b82f6']
      }]
    },
    options: { plugins: { legend: { display: false } } }
  });

  const valuationChart = new Chart(valuationCtx, {
    type: 'line',
    data: {
      labels: ['3 Years', '5 Years', '10 Years'],
      datasets: [{
        label: 'Valuation',
        data: [2500000, 3500000, 5000000],
        borderColor: '#8b5cf6',
        fill: true,
        backgroundColor: 'rgba(139,92,246,0.15)',
        tension: 0.3
      }]
    },
    options: {
      plugins: { legend: { display: false } },
      scales: { y: { beginAtZero: false } }
    }
  });

  window.homeCharts.push(incomeExpenseChart, valuationChart);
}

function updateCashFlow() {
            const totalIncome = Object.values(properties).reduce((total, property) => {
                return total + (property.propertyStatus === 'rented' ? parseFloat(property.monthlyRent) : 0);
            }, 0);
            
            const totalExpenses = Math.round(totalIncome * 0.25);
            const netProfit = totalIncome - totalExpenses;
            
            document.getElementById('totalIncome').textContent = '‚Çπ' + totalIncome.toLocaleString();
            document.getElementById('totalExpenses').textContent = '‚Çπ' + totalExpenses.toLocaleString();
            document.getElementById('netProfit').textContent = '‚Çπ' + netProfit.toLocaleString();
            
            updateTransactions();
        }

        function updateTransactions() {
            const transactionsList = document.getElementById('transactions-list');
            const dashTransactions = document.getElementById('recent-transactions');
            const rentedProperties = Object.values(properties).filter(p => p.propertyStatus === 'rented');
            
            if (rentedProperties.length === 0) {
                const emptyMsg = '<p style="text-align: center; color: #999; padding: 20px 0;">No recent transactions</p>';
                if (transactionsList) transactionsList.innerHTML = emptyMsg;
                if (dashTransactions) dashTransactions.innerHTML = '<p style="color:#6b7280;">No recent transactions.</p>';
                return;
            }
            
            const transactions = rentedProperties.map(property => {
                const date = new Date();
                date.setDate(date.getDate() - Math.floor(Math.random() * 7));
                
                return {
                    name: `Rent - ${property.propertyName}`,
                    date: date.toLocaleDateString(),
                    amount: parseFloat(property.monthlyRent)
                };
            });
            
            transactions.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            const transactionHTML = transactions.map(t => `
                <div class="transaction-item">
                    <div class="transaction-info">
                        <h4>${t.name}</h4>
                        <p>${t.date}</p>
                    </div>
                    <div class="transaction-amount income">
                        +‚Çπ${t.amount.toLocaleString()}
                    </div>
                </div>
            `).join('');
            
            if (transactionsList) transactionsList.innerHTML = transactionHTML;
            
            if (dashTransactions) {
                const dashHTML = transactions.slice(0, 3).map(t => `
                    <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e5e7eb;">
                        <span style="color:#374151;">${t.name}</span>
                        <span style="color:#10b981;">+‚Çπ${t.amount.toLocaleString()}</span>
                    </div>
                `).join('');
                dashTransactions.innerHTML = dashHTML;
            }
        }

        function renderCashFlowCharts() {
            // Destroy existing charts to prevent duplicates
            Object.values(chartInstances).forEach(chart => chart.destroy());
            chartInstances = {};

            const makeChart = (id, labels, income, expense, valuation) => {
                const ctx = document.getElementById(id);
                if (!ctx) return;

                chartInstances[id] = new Chart(ctx, {
                    type: "line",
                    data: {
                        labels,
                        datasets: [
                            {
                                label: "Income",
                                data: income,
                                borderColor: "#10b981",
                                backgroundColor: "rgba(16, 185, 129, 0.1)",
                                fill: true,
                                tension: 0.4
                            },
                            {
                                label: "Expense",
                                data: expense,
                                borderColor: "#ef4444",
                                backgroundColor: "rgba(239, 68, 68, 0.1)",
                                fill: true,
                                tension: 0.4
                            },
                            {
                                label: "Valuation",
                                data: valuation,
                                borderColor: "#3b82f6",
                                backgroundColor: "rgba(59, 130, 246, 0.1)",
                                fill: true,
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                position: "bottom",
                                labels: {
                                    padding: 15,
                                    font: {
                                        size: 11
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: "Years",
                                    font: { size: 11 }
                                },
                                grid: {
                                    display: false
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: "Amount (‚Çπ)",
                                    font: { size: 11 }
                                },
                                beginAtZero: false,
                                ticks: {
                                    callback: function(value) {
                                        return '‚Çπ' + (value / 1000) + 'k';
                                    }
                                }
                            }
                        }
                    }
                });
            };

            // 3-Year Chart
            makeChart("flow3yr", ["Y1", "Y2", "Y3"],
                [120000, 150000, 180000],
                [60000, 80000, 95000],
                [2500000, 2750000, 3100000]
            );

            // 5-Year Chart
            makeChart("flow5yr", ["Y1", "Y2", "Y3", "Y4", "Y5"],
                [120000, 135000, 145000, 160000, 175000],
                [60000, 65000, 72000, 78000, 85000],
                [2500000, 2700000, 2900000, 3200000, 3500000]
            );

            // 10-Year Chart
            makeChart("flow10yr", ["Y1", "Y2", "Y3", "Y4", "Y5", "Y6", "Y7", "Y8", "Y9", "Y10"],
                [120000, 130000, 140000, 150000, 160000, 175000, 190000, 205000, 220000, 235000],
                [60000, 62000, 64000, 66000, 68000, 70000, 73000, 76000, 79000, 82000],
                [2500000, 2600000, 2700000, 2800000, 2950000, 3100000, 3250000, 3400000, 3550000, 3700000]
            );
        }

        function showStep(step) {
            document.querySelectorAll('.step-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.step-content').forEach(sec => sec.classList.remove('active'));
            document.querySelector(`.step-btn:nth-child(${step})`).classList.add('active');
            document.getElementById(`step${step}`).classList.add('active');
        }

        function showSubTab(tab) {
            document.querySelectorAll('.sub-tab').forEach(e => e.classList.remove('active'));
            document.querySelectorAll('.sub-btn').forEach(e => e.classList.remove('active'));
            document.getElementById('sub-' + tab).classList.add('active');
            document.querySelector(`.sub-btn[onclick="showSubTab('${tab}')"]`).classList.add('active');
        }

        function removeItem(btn) {
            btn.parentElement.remove();
            updateTotals();
        }

        function addRevenue() {
            const n = document.getElementById("newRevName").value;
            const v = document.getElementById("newRevValue").value;
            if (!n || !v) return alert("Enter name & amount");
            const d = document.createElement("div");
            d.className = "expense-item";
            d.innerHTML = `<input type="text" value="${n}"><input type="number" value="${v}" oninput="updateTotals()"><button onclick="removeItem(this)">‚úñ</button>`;
            document.getElementById("extraRevenue").appendChild(d);
            document.getElementById("newRevName").value = "";
            document.getElementById("newRevValue").value = "";
            updateTotals();
        }

        function addCustomExpense() {
            const n = document.getElementById("customName").value;
            const v = document.getElementById("customAmount").value;
            if (!n || !v) return alert("Enter name & amount");
            const d = document.createElement("div");
            d.className = "expense-item";
            d.innerHTML = `<input type="text" value="${n}"><input type="number" value="${v}" oninput="updateTotals()"><button onclick="removeItem(this)">‚úñ</button>`;
            document.getElementById("customExpenses").appendChild(d);
            document.getElementById("customName").value = "";
            document.getElementById("customAmount").value = "";
            updateTotals();
        }

        function addLoan() {
            const d = document.createElement("div");
            d.className = "expense-item";
            d.innerHTML = `<input type="text" placeholder="Loan Name"><input type="number" placeholder="Amount" oninput="updateTotals()"><button onclick="removeItem(this)">‚úñ</button>`;
            document.getElementById("loanList").appendChild(d);
            updateTotals();
        }

        function updateTotals() {
            const numSum = id => [...document.querySelectorAll(`#${id} input[type=number]`)]
                .reduce((a, i) => a + Number(i.value || 0), 0);
            const rev = numSum('extraRevenue') + Number(document.getElementById('avgMargin').value || 0) * Number(document.getElementById('dailyGallons').value || 0);
            const exp = numSum('maintenanceList') + numSum('operatingList') + numSum('customExpenses');
            const loans = numSum('loanList');
            const equity = Number(document.getElementById('cashInvestment').value || 0) +
                (Number(document.getElementById('closingCost').value || 0) / 100) * Number(document.getElementById('cashInvestment').value || 0);
            const noi = rev - exp;

            document.getElementById('totalRevenue').textContent = rev.toLocaleString();
            document.getElementById('totalExpenses').textContent = exp.toLocaleString();
            document.getElementById('totalEquity').textContent = equity.toLocaleString();
            document.getElementById('totalLoan').textContent = loans.toLocaleString();
            document.getElementById('dynRevenue').textContent = rev.toLocaleString();
            document.getElementById('dynExpenses').textContent = exp.toLocaleString();
            document.getElementById('dynNOI').textContent = noi.toLocaleString();
        }

        function updateSlider(id, val) {
            document.getElementById(id).innerText = val + '%';
        }

        function updateDynamicField() {
            const container = document.getElementById("dynamicFieldContainer");
            const type = document.getElementById("propertyType").value;
            container.innerHTML = "";

            if (!type) return;

            const fields = {
                villa: { label: "Total Rental Units", placeholder: "e.g. 5" },
                hotel: { label: "Total Rooms", placeholder: "e.g. 80" },
                restaurant: { label: "Seating Capacity", placeholder: "e.g. 50" },
                office: { label: "Total Offices", placeholder: "e.g. 10" },
                industrial: { label: "Warehouse Units", placeholder: "e.g. 3" }
            };

            const field = fields[type];
            container.innerHTML = `
                <div class="form-group">
                    <label>${field.label}</label>
                    <input type="text" id="dynamicInput" placeholder="${field.placeholder}">
                </div>
            `;
        }

        function handleFiles(files) {
            const preview = document.getElementById("previewContainer");
            preview.innerHTML = "";
            Array.from(files).forEach(file => {
                if (file.type.startsWith("image/")) {
                    const reader = new FileReader();
                    reader.onload = e => {
                        const img = document.createElement("img");
                        img.src = e.target.result;
                        preview.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        function saveProperty() {
            const propertyName = document.getElementById("propertyName").value.trim();
            const propertyType = document.getElementById("propertyType").value;
            const purchasePrice = document.getElementById("purchasePrice").value;
            const city = document.getElementById("city").value.trim();
            
            if (!propertyName || !propertyType || !purchasePrice || !city) {
                alert("Please fill in all required fields in Step 1");
                showStep(1);
                return;
            }

            const dynamicInput = document.getElementById("dynamicInput");
            const dynamicValue = dynamicInput ? dynamicInput.value : "";

            const totalRevenue = document.getElementById("totalRevenue").textContent.replace(/,/g, '');
            const totalExpenses = document.getElementById("totalExpenses").textContent.replace(/,/g, '');
            const noi = document.getElementById("dynNOI").textContent.replace(/,/g, '');
            const totalEquity = document.getElementById("totalEquity").textContent.replace(/,/g, '');

            const revGrowth = document.getElementById("revVal").textContent;
            const expGrowth = document.getElementById("expVal").textContent;
            const exitCap = document.getElementById("capVal").textContent;

            const images = Array.from(document.querySelectorAll('#previewContainer img'))
                .map(img => img.src);
            const mainImage = images.length > 0 ? images[0] : 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=400';

            const newProperty = {
                id: nextPropertyId++,
                propertyName: propertyName,
                propertyType: propertyType,
                streetAddress: dynamicValue || "N/A",
                city: city,
                state: "N/A",
                zipCode: "N/A",
                bedrooms: "N/A",
                bathrooms: "N/A",
                sqft: dynamicValue || "N/A",
                monthlyRent: purchasePrice,
                propertyStatus: "available",
                image: mainImage,
                financials: {
                    purchasePrice: purchasePrice,
                    totalRevenue: totalRevenue,
                    totalExpenses: totalExpenses,
                    noi: noi,
                    totalEquity: totalEquity,
                    revGrowth: revGrowth,
                    expGrowth: expGrowth,
                    exitCap: exitCap
                }
            };

            properties[newProperty.id] = newProperty;

            document.getElementById("propertyName").value = "";
            document.getElementById("propertyType").value = "";
            document.getElementById("purchasePrice").value = "";
            document.getElementById("city").value = "";
            document.getElementById("previewContainer").innerHTML = "";
            document.getElementById("dynamicFieldContainer").innerHTML = "";

            showStep(1);

            renderProperties();
            updateDashboard();
            updateCashFlow();

            alert("‚úÖ Property saved successfully!");
            showPage('properties');
        }

        function loadProfileImage(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = e => {
                document.getElementById("profilePicPreview").src = e.target.result;
                const settings = JSON.parse(localStorage.getItem("userSettings")) || {};
                settings.profilePic = e.target.result;
                localStorage.setItem("userSettings", JSON.stringify(settings));
            };
            reader.readAsDataURL(file);
        }

        function saveSettings() {
            const settings = {
                fullName: document.getElementById("fullName").value,
                email: document.getElementById("email").value,
                phone: document.getElementById("phone").value,
                theme: document.getElementById("theme").value,
                currency: document.getElementById("currency").value,
                profilePic: document.getElementById("profilePicPreview").src
            };

            localStorage.setItem("userSettings", JSON.stringify(settings));
            alert("‚úÖ Settings saved successfully!");
        }

        function loadSettings() {
            const saved = localStorage.getItem("userSettings");
            if (!saved) return;
            const settings = JSON.parse(saved);

            document.getElementById("fullName").value = settings.fullName || "";
            document.getElementById("email").value = settings.email || "";
            document.getElementById("phone").value = settings.phone || "";
            document.getElementById("theme").value = settings.theme || "Light";
            document.getElementById("currency").value = settings.currency || "INR (‚Çπ)";

            if (settings.profilePic && settings.profilePic.startsWith("data:image")) {
                document.getElementById("profilePicPreview").src = settings.profilePic;
            }
        }

        function exportData(format) {
            const propertiesData = Object.values(properties);
            
            if (propertiesData.length === 0) {
                alert("No properties to export!");
                return;
            }

            if (format === 'csv') {
                const headers = ['Property Name', 'Type', 'City', 'Status', 'Monthly Rent'];
                const rows = propertiesData.map(p => [
                    p.propertyName,
                    p.propertyType,
                    p.city,
                    p.propertyStatus,
                    p.monthlyRent
                ]);
                
                let csv = headers.join(',') + '\n';
                rows.forEach(row => {
                    csv += row.map(cell => `"${cell}"`).join(',') + '\n';
                });
                
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'properties_export.csv';
                a.click();
                window.URL.revokeObjectURL(url);
                
                alert('‚úÖ CSV exported successfully!');
            } else if (format === 'pdf' || format === 'excel') {
                alert(`${format.toUpperCase()} export functionality - Coming soon! Currently only CSV export is available.`);
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            ['search-input', 'status-filter', 'type-filter'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener(id === 'search-input' ? 'input' : 'change', filterProperties);
                }
            });

            updateTotals();
            renderProperties();
            updateDashboard();
            loadSettings();
        });

     async function exportData(format) {
  if (format !== "pdf") return alert("Only PDF export supported right now.");

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit: "pt", format: "a4" });
  let y = 40;

  // ‚úÖ Static property list with images
  const staticProperties = [
    {
      name: "Sunrise Apartments",
      location: "Ahmedabad",
      value: "‚Çπ45,00,000",
      income: "‚Çπ18,000",
      expense: "‚Çπ4,000",
      image: "https://picsum.photos/200/120?random=1",
    },
    {
      name: "Skyline Towers",
      location: "Rajkot",
      value: "‚Çπ55,00,000",
      income: "‚Çπ20,000",
      expense: "‚Çπ5,500",
      image: "https://picsum.photos/200/120?random=2",
    },
    {
      name: "Ocean View Villa",
      location: "Jamnagar",
      value: "‚Çπ75,00,000",
      income: "‚Çπ30,000",
      expense: "‚Çπ7,000",
      image: "https://picsum.photos/200/120?random=3",
    },
  ];

  const chartSummary = {
    totalIncome: "‚Çπ5,600",
    totalExpense: "‚Çπ2,450",
    netProfit: "‚Çπ3,150",
  };

  // --- Header ---
  doc.setFontSize(18);
  doc.text("Property Tracker ‚Äì Full Report", 40, y);
  y += 30;

  // --- User Info ---
  doc.setFontSize(12);
  doc.text("Name: Parth Dattani", 50, y);
  doc.text("Email: parth@gmail.com", 50, y + 15);
  doc.text("Phone: 09512359792", 50, y + 30);
  doc.text("Theme: Light", 50, y + 45);
  doc.text("Currency: INR (‚Çπ)", 50, y + 60);
  y += 90;

  // --- Property Portfolio ---
  doc.setFontSize(14);
  doc.text("Property Portfolio", 40, y);
  y += 20;
  doc.setFontSize(11);

  for (let i = 0; i < staticProperties.length; i++) {
    const p = staticProperties[i];

    // Load property image as Base64
    try {
      const img = await loadImageAsBase64(p.image);
      doc.addImage(img, "JPEG", 50, y, 140, 90);
    } catch (e) {
      console.warn("Image failed to load:", e);
    }

    // Property text
    doc.text(`${i + 1}. ${p.name} (${p.location})`, 200, y + 15);
    doc.text(`Value: ${p.value}`, 200, y + 35);
    doc.text(`Rent: ${p.income}`, 200, y + 50);
    doc.text(`Expense: ${p.expense}`, 200, y + 65);
    y += 110;

    // Auto add new page if space runs out
    if (y > 700) {
      doc.addPage();
      y = 60;
    }
  }

  y += 20;

  // --- Cash Flow Summary ---
  doc.setFontSize(14);
  doc.text("Cash Flow Summary", 40, y);
  y += 20;
  doc.setFontSize(11);
  doc.text(`Total Income: ${chartSummary.totalIncome}`, 50, y);
  doc.text(`Total Expenses: ${chartSummary.totalExpense}`, 50, y + 15);
  doc.text(`Net Profit: ${chartSummary.netProfit}`, 50, y + 30);
  y += 60;

  // --- Create Hidden Charts ---
  const chartContainer = document.createElement("div");
  chartContainer.style.display = "none";
  document.body.appendChild(chartContainer);

  const incomeCanvas = document.createElement("canvas");
  const growthCanvas = document.createElement("canvas");
  chartContainer.appendChild(incomeCanvas);
  chartContainer.appendChild(growthCanvas);

  // Chart 1: Income vs Expense
  new Chart(incomeCanvas.getContext("2d"), {
    type: "bar",
    data: {
      labels: ["Income", "Expenses", "Profit"],
      datasets: [{
        data: [5600, 2450, 3150],
        backgroundColor: ["#10b981", "#ef4444", "#3b82f6"],
      }],
    },
    options: { responsive: false, plugins: { legend: { display: false } } },
  });

  // Chart 2: Valuation Growth
  new Chart(growthCanvas.getContext("2d"), {
    type: "line",
    data: {
      labels: ["3 Years", "5 Years", "10 Years"],
      datasets: [{
        label: "Valuation Growth (‚Çπ)",
        data: [4500000, 5800000, 7600000],
        borderColor: "#8b5cf6",
        fill: false,
        tension: 0.3,
      }],
    },
    options: { responsive: false, plugins: { legend: { display: true } } },
  });

  // Wait to render charts
  await new Promise((r) => setTimeout(r, 1200));

  // Convert charts to base64 images
  const img1 = incomeCanvas.toDataURL("image/png");
  const img2 = growthCanvas.toDataURL("image/png");

  // Add charts
  doc.addImage(img1, "PNG", 60, y, 480, 220);
  y += 250;

  if (y > 700) {
    doc.addPage();
    y = 60;
  }

  doc.addImage(img2, "PNG", 60, y, 480, 220);

  // Clean up
  chartContainer.remove();

  // Save file
  doc.save("Property_Report.pdf");
}

// Utility: Convert image URL to Base64
async function loadImageAsBase64(url) {
  const res = await fetch(url);
  const blob = await res.blob();
  return new Promise((resolve) => {
    const reader = new FileReader();
    reader.onloadend = () => resolve(reader.result);
    reader.readAsDataURL(blob);
  });
}
 </script>
</body>
</html>